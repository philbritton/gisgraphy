<html>
<head>
 <style type="text/css" media="all">
@import url("./css/maven-base.css");

@import url("./css/maven-theme.css");

@import url("./css/site.css");

h1 {
	counter-reset: section;
	counter-reset: subsection;
	counter-reset: indexsection;
	counter-reset: indexsubsection;
	counter-reset: subsubsection;
}

h2 {
	counter-increment: section;
	counter-reset: subsection;
}

h2:before {
	content: counter(section) " ";
}

h3 {
	counter-increment: subsection;
	counter-reset: subsubsection;
}

h3:before {
	content: counter(section) "." counter(subsection) " ";
}

h4 {
	counter-increment: subsubsection;
}

h4:before {
	content: counter(section) "." counter(subsection) "."
		counter(subsubsection) " ";
}

.indexlevel2 {
	counter-increment: indexsection;
	counter-reset: indexsubsection;
	padding-left: 24px;
}

.indexlevel2:before {
	content: counter(indexsection) " ";
}

.indexlevel3 {
	counter-increment: indexsubsection;
	padding-left: 40px;
}

.indexlevel3:before {
	content: counter(indexsection) "." counter(indexsubsection) " ";
}
</style>
</head>
<body>
<h1>Gisgraphy user guide</h1>
<a name="top"></a>
<br/>
<div class="tip greentip">
To suggest a change or a correction to any part of the documentation, please send a mail to <a href="mailto:david.masclet@gisgraphy.com">David Masclet</a>.
</div>
<br/>
<div class="indexlevel2"><a href="#introduction" />Introduction</a></div>
<div class="indexlevel3"><a href="#about" />About</a></div>
<div class="indexlevel3"><a href="#technics" />A little bit of technic...</a></div>
<div class="indexlevel3"><a href="#whatfor" />What's gisgraphy for ?</a></div>
<div class="indexlevel3"><a href="#examplesuse" />Some examples of uses</a></div>
<div class="indexlevel3"><a href="#requirements" />Requirements</a></div>
<div class="indexlevel3"><a href="#technologiesused" />What technologies are used ?</a></div>
<div class="indexlevel3"><a href="#placetypeschema" />Placetype schema</a></div>
<div class="indexlevel3"><a href="#license" />License</a></div>
<div class="indexlevel2"><a href="#installation" />Installation</a></div>
<div class="indexlevel2"><a href="#importdata" />Import Data</a></div>
<div class="indexlevel3"><a href="#options" />Options and environement specific settings</a></div>
<div class="indexlevel3"><a href="#importfailure" />Import failure</a></div>
<div class="indexlevel2"><a href="#fulltextservice" />Full text service</a></div>
<div class="indexlevel3"><a href="#fulltextservicedescription" />Description</a></div>
<div class="indexlevel3"><a href="#fulltextserviceparameters" />Parameters</a></div>
<div class="indexlevel3"><a href="#fulltextwebservice" />Web service</a></div>
<div class="indexlevel3"><a href="#fulltextserviceoutputfieldsdescription" />Output fields description</a></div>
<div class="indexlevel3"><a href="#fulltextservicejavaapi" />Java API</a></div>
<div class="indexlevel2"><a href="#geolocservice" />Geolocalisation service</a></div>
<div class="indexlevel3"><a href="#geolocservicedescription" />Description</a></div>
<div class="indexlevel3"><a href="#geolocserviceparameters" />Parameters</a></div>
<div class="indexlevel3"><a href="#geolocwebservice" />Web service</a></div>
<div class="indexlevel3"><a href="#geolocserviceoutputfieldsdescription" />Output fields description</a></div>
<div class="indexlevel3"><a href="#geolocservicejavaapi" />Java API</a></div>
<div class="indexlevel2"><a href="#admininterface" />Admin Interface</a></div>
<div class="indexlevel3"><a href="#adminloginpassword" />Login - Password</a></div>
<div class="indexlevel3"><a href="#adminimportdata" />Import data</a></div>
<div class="indexlevel3"><a href="#adminscreenshots" />Screenshots</a></div>
<div class="indexlevel2"><a href="#security" />Security</a></div>
<div class="indexlevel3"><a href="#defaultusersecurity" />Default admin password</a></div>
<div class="indexlevel3"><a href="#protectwebservices" />Protect webServices</a></div>
<div class="indexlevel2"><a href="#performance" />Performance</a></div>
<div class="indexlevel3"><a href="#jmeter" />Jmeter</a></div>
<div class="indexlevel3"><a href="#databaseoptimisation" />Database optimisations</a></div>
<div class="indexlevel3"><a href="#jvmoptimisation" />JVM optimisations</a></div>


<a name="introduction"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Introduction</h2>
<a name="about"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>About</h3>
Gisgraphy is a Free opensource geocoder and webservices for geonames and openstreetmap data. 
	from several databases (aka : gazeteers) on the Web (mainly Geonames, but not only : ESRI for instance). It provides an importer to inject the data into a strongly typed Postgres / Postgis database and use them via 2 webservices or a java API : geolocalisation and fulltext in many format (XML, json, PHP, ruby, python, Atom, RSS / GeoRSS). Here are the main functionalities  :
<ul>
<li> Importers from geonames CSV files. Just give the country(ies) you wish to import and / or the <a href="/placetype.htm">placetypes</a>, and Gisgraphy download the files  and import them with all the alternateNames (optional), and sync the database with the fulltext search engine</li>
<li> REST WebService</li>
<li> Several output formats supported : XML, json, PHP, ruby, python, Atom, RSS / GeoRSS  </li>
<li> Full text search  (based on <a href="http://lucene.apache.org/java/"/>Lucene</a> / <a href="http://lucene.apache.org/solr/"/>Solr</a>  with default filters optimized for city search
(case insensitivity, separator characters stripping, ..) via an Java API or a webservice</li>
<li> Findnearby function (with limits, pagination, restrict to a specific country and/or language and other useful options) via a Java API or a Web Service</li>
<li> An admin / back office whith statistics <a href="http://www.gisgraphy.com/screenshots.htm"> interface</a></li>
<li> Fully replicated / scalable / high performance / cached services</li>
<li> Search for zipcode name, IATA, ICAO </li>
<li> Internationalized (with support of cyrillique, arabic, chinese,... alphabet)</li>
<li> Dojo widgets / prototype / Ajax to ease search but can be use it even if javascript is not enabled on the client side</li>
<li> <li> <a href="http://www.gisgraphy.com/documentation/addons.htm#opensearch">Opensearch module</a></li></li>
<li> Plateform / language independent</li>
<li> Provides all the countries flags in svg and png format</li> 
</ul>
<a name="technics"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>A little bit of technic...</h3>
<ul>
<li> Spring Services / Hibernate mapping with its own hibernate dialect </li>
<li> Lucene Schema </li>
<li> Use Postgres / postgis but will be soon compliant with other Spatial providers (Oracle, Mysql,...)</li>
<li> Build using Maven2</li>
<li> Automatic synchronization between Postgres and Solr</li>
<li> High test coverage</li>
<li> Event - based design</li>
<li> UTF-8 all over the place</li>
<li> Gisgraphy has its <a href="http://gisgraphy.free.fr/mavenrepo">own maven repository</a> with all the dependencies</li>
<li> Designed with <a href="http://www.infoq.com/articles/internal-dsls-java">DSL</a> (Domain Specific Language) </li>
<li> Designed with the <a href="http://www.domaindrivendesign.org/">DDD</a> paradigm</li>
</ul>
<a name="whatfor"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>What's Gisgraphy for ?</h3>
<ul>
<li> Find places (city, lake, forest, country, stream, castle airport, more than 650 different features) via a Web service a Java API
<li> Find city by Zipcode</li>
<li> Import geonames features into a strongly typed database with error correction.</li>
<li> Use Spring hibernate to manage places</li>
<li> Find places around a GPS point or an other place via a REST API or a Java API</li>
<li> use Dojo widgets / prototype / javascript to ease search </li>
</ul>
<a name="examplesuse"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Some examples of uses</h3>
<ul>
<li> I ve got a project in an other language than java and I want to offer a city fullText search, and open a popup if more than one result match</li>
<li> I ve got a java project and i need Spring Dao and services / hibernate Mapping for geoloc</li>
<li> I want to import all the features of Geonames for United state and use them in Python </li>
<li> Get the zipcode of washington</li>
<li> Find all the forests around Paris and their distances, with a radius of 30 km in spanish, order by distance</li>
<li> Find all the city that match 'Paris' and paginate from 1 to 1O with scoring.</li>
<li> Find all the lake of Ireland in JSON format and limit the search to 5 results.</li>
<li> Find the GPS position of London.</li>
<li> Search 'Saint-Andr&eacute;', 'st andre', 'SaInT andr&eacute;', 'st-andr&eacute;'; will return the same instance...</li>
<li> Search paris texas will not return the french capital.</li>
<li> Type 'lutece' or 'paname' and get Paris.</li>
<li> Locate on a google map or yahoo map the results.</li>
<li> Search the elevation of Madrid.</li>
<li> What is the flag of Argentina</li>
<li> Find the administrative division of New york.</li>
<li> Search the nearest city for the GPS point lat=47.5/Long=5 .</li>
<li> Search all the monuments / restaurants and hotels around a given GPS position.</li>
<li> Search the country for a specified GPS point.</li>
<li> Find the limitroph countries of Brasil. </li>
</ul>
<a name="requirements"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Requirements</h3>
<ul>
<li>Gisgraphy needs Java 1.5 or greater</li>
<li><a href="http://www.postgresql.org/">PostgreSQL</a> with <a href="http://postgis.refractions.net/">Postgis</a> extension (It is HIGHLY recommended to have postgis 1.3.1 or greater for good performances... <a href="#postgis1.1.3">more</a> )</li>
<li>A servlet container if you want to use it as a Servlet (Not programatically). Actually Gisgraphy has been tested on <a href="http://tomcat.apache.org/">Tomcat</a> and <a href="http://www.mortbay.org/">Jetty</a> but any Servlet container should be OK</li>
</ul>
<a name="technologiesused"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>What technologies are used ?</h3>
<ul>
<li>Java</li>
<li>Maven 2</li>
<li>Spring</li>
<li>Hibernate</li>
<li>PostgreSQL / Postgis </li>
<li>SolR / Lucene</li>
<li>Jersey (probably CXF in next version)</li>
<li>Hibernate Spatial</li>
<li>Appfuse</li>
<li>Dojo / prototype (in Version 1.0)</li>
</ul>


<a name="placetypeschema"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Placetype schema</h3>
Here is a simple diagramme that represents relation beetween the placetype, gisFeature, Adm, country, and languages.<br/><br/>
<div><img src="../images/placetype.png"/></div>
<br/><br/>
GisFeature is the mother class of all the placetype, it has all the basic informations.<br/>
Language represents a spoken language<br/>
AlternateName is a specific name for a specific language.</br>
<br/>

All the placetype extends gisFeature. Such as :
<ul>
<li>City</li>
<li>Country</li>
<li>Adm (aka : administrative division)</li>
<li>All the other placetypes </li>
</ul>
<br/>
Adm are in tree structure.<br/> 
<br/>
A GisFeature :
<ul>
<li>Belongs to an Adm</li>
<li>Belongs to a country</li>
<li>Has some alternate names for a specific language</li> 
</ul>
<br/>

<a name="license"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>License</h3>
Gisgraphy is licensed under the terms of the <a href="http://www.gnu.org/licenses/lgpl-3.0.html">LGPL V3.0</a> License
<br/>
<a name="installation"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Installation</h2>
<a name="installpostgres"></a>
<div align="right"><a href="#top">[top]</a></div>
<div>Please go the the <a href="./installation">installation page</a></div>
<a name="importdata"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Import Data</h2>
You must use the admin interface. see the <a href="#admininterface">admin interface section</a> for more informations


<a name="debugMode"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Debug Mode</h3>
Each Gisgraphy service (Geoloc and fulltext) is a servlet.
Each servlet can be run in debug Mode. The error message will be in verbose mode. To do so just declare the servlet init parameter "debugMode" to true (in the web.xml) as shown :  
<div class ="code">
<pre>
&lt;servlet&gt;
		&lt;servlet-name&gt;geoloc service&lt;/servlet-name&gt;
		&lt;servlet-class&gt;
			com.gisgraphy.servlet.GeolocServlet
		&lt;/servlet-class&gt;
		 &lt;init-param&gt;
		 &lt;!-- if true the output field error will contains the exception message. Default to false --&gt;
			&lt;param-name&gt;debugMode&lt;/param-name&gt;
			&lt;param-value&gt;true&lt;/param-value&gt;
		&lt;/init-param&gt;
		&lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
	
	
&lt;servlet&gt;
		&lt;servlet-name&gt;fulltext service&lt;/servlet-name&gt;
		&lt;servlet-class&gt;
			com.gisgraphy.servlet.FulltextServlet
		&lt;/servlet-class&gt;
		&lt;init-param&gt;
		 &lt;!-- if true the output field error will contains the exception message. Default to false --&gt;
			&lt;param-name&gt;debugMode&lt;/param-name&gt;
			&lt;param-value&gt;true&lt;/param-value&gt;
		&lt;/init-param&gt;
		&lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
&lt;/servlet&gt;
	
</pre>
</div>

<a name="options"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Options and environement specific settings</h3>
All the options and environement specific settings are located in the env.properties file. The env.properties is located in the $GISGRAPHYDISTRIBUTION/webapps/ROOTWEB-INF/classes directory of the Gisgraphy distribution
<div class="tip yellowtip">
Take care of white spaces in properties file : MyProperties=bar is not the same as MyProperties= bar (whitespace after the equals sign are taken into accounts)
</div>

<div align="right"><a href="#top">[top]</a></div>
<h4>importer.geonames.dir</h4>
This option determines the directory where the Geonames files are located. It must ends with / or \ according to the system path separator. it is also the directory where the Geonames files will be downloaded from the <code>importer.geonames.downloadURL</code> URL
. On Windows The '\' character must be escaped as in the example bellow . The path can be absolute or relative (from the directory where you've launch Gisgraphy). It is not recommended to put space in the path.<br/>. This option is case sensitive if the underlaying file system is case sensitive (e.g : Linux / Unix).
<div class="code">
Examples on Linux :<br/>
importer.geonames.dir=./data/prod/<br/>
importer.geonames.dir=/home/user/data/prod/<br/>
<br/>
Example on Windows<br/>
importer.geonames.dir=.\\data\\prod\\
<!-- TODO v1 examples with space and c:\-->
</div>
<br/><br/>

<div class="tip yellowtip">
Don't forget the ending slash (or backslash if you use windows) !
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importer.geonames.downloadURL</h4>
This option determines the URL of the server to download the files to be processed. This option is case sensitive
<div class="code">
Example : <br/>
importer.geonames.downloadURL=http://download.geonames.org/export/dump/
</div>
<br/><br/>
<div class="tip yellowtip">
Don't forget the ending slash for the URL !
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importer.filesToDownload</h4>
This option determines the files to be download from the <code>importer.geonames.downloadURL</code> URL. The files must be ';' separated. You can specify any files, but if you download from the Geonames server, you should specify country ZIP files (or allcountries.zip) and alternateNames.zip . This option is case sensitive.
<br/>
<div class="code">
Examples : <br/>
importer.filesToDownload=AD.zip;CY.zip<br/>
importer.filesToDownload=allCountries.zip<br/>
<br/>
</div>
<br/>
<div class="tip yellowtip">If you run an import and the change the option and re-run an import : you must delete the old downloaded file before re-run the import. If you don't : the files you've downloaded will be processed. 
</div>
<br/>
<div class="tip greentip">It is not necessary To download Countries.txt,iso-languagecodes.txt, because there are already in the Gisgraphy distrib. Just focus on the country you want to process and alternatenames.zip if you want to import alternate names.
<br><br/>If allCountries.txt file is in the <code>importer.geonames.dir</code> Directory, the other countries files will be logically ignored.
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importer.retrieveFiles</h4>
Wether the files defined by the <code>importer.filesToDownload</code> option should be downloaded. If 'true' the importer will download the files according to the <code>importer.filesToDownload</code> option. If 'false', it will use the files already presents in <code>importer.geonames.dir</code>. This option should be in lower case
<br/>
<div class="code">
Examples : <br/>
importer.retrieveFiles=true<br/>
importer.retrieveFiles=false
</div>
<br/><br/>
<a name="fulltextsearchurl"></a>
<div align="right"><a href="#top">[top]</a></div>
<h4>fulltextSearchUrl</h4>
The URL of the SolR Server. If you use the SolR server of the Gisgraphy distribution : the URL should be the Gisgraphy URL follow by solr (name of the war file). If you need better performance, (that's to say run Gisgraphy and the SolR server in two distinct JVM. see <a href="#jvmoptimisation">jvm optimisation</a>) : specify the URL of the server you want to use. This option is case sensitive.
<div class="code">
Examples : <br/>
fulltextSearchUrl=http://localhost:8080/solr/<br/>
<br/>
Example with the default SolR port <br/>
fulltextSearchUrl=http://localhost:8983/solr/
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.wrongNumberOfFieldsThrows</h4>
Wether we should throws an exception and stop the import if a line in an imported file haven't the expected number of fields (CSV fields). This option should be in lower case. it is recommended to set it to false in a standard import. if you use Gisgraphy for errors correction, set it to true.

<div class="tip greentip">Even if you want to do errors correction, and set it to false, you can see the reported errors in log files and fix them at the end of the import. It can be easier to fix all the errors in one time.</div>
<br/>

<br/>
<div class="code">
Examples : <br/>
importerConfig.wrongNumberOfFieldsThrows=true<br/>
importerConfig.wrongNumberOfFieldsThrows=false
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.missingRequiredFieldThrows</h4>
Wether we should throws an exception and stop the import of data if a required field is missing. This option should be in lower case. It is recommended to set it to false in a standard import. If you use Gisgraphy for errors correction, set it to true.
<div class="tip greentip">Even if you want to do errors correction, and set it to false, you can see the reported errors in log files and fix them at the end of the import. It can be easier to fix all the errors in one time.</div>
<br/><br/>
<div class="code">
Examples : <br/>
importerConfig.missingRequiredFieldThrows=true<br/>
importerConfig.missingRequiredFieldThrows=false
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.acceptRegExString</h4>

List of regular expresions separated by ';' that determines the <a href="http://forum.geonames.org/gforum/posts/list/130.page">feature class / code</a> to be imported. The default value is .*  (all the feature class / code).
The regular expressions must match <code>featureClass.featureCode</code>. The gisFeature which matches "A.ADM." (administrative divisions) and "A.PCL." (countries) regex are automaticaly imported. This option is case sensitive and the should be set in upper case because feature class / code are in upper case.
imported (Administrative division and country).
<div class="code">
Examples :<br/>
.* : import all gisfeatures, no matter their feature class / code<br/>
P[.]PPL[A-Z&&[^QW]];P[.]PPL$;P[.]STLMT$ : import Israeli settlements and all the cities except destroyed and abandoned city<br/>
V.FRST. : import all the forests<br/>
P[.]PPL[A-Z&&[^QW]];P[.]PPL$;P[.]STLMT$;V.FRST. : import Israeli settlements and all the cities except destroyed and abandoned city, and the forests<br/>
<br/>
</div>
<br/>
<div class="tip greentip">
See <a href="http://download.geonames.org/export/dump/featureCodes.txt">http://download.geonames.org/export/dump/featureCodes.txt</a> to have a full description of feature class / code or see <a href="http://forum.geonames.org/gforum/posts/list/130.page">what are the "feature codes" used in GeoNames ?</a>
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.tryToDetectAdmIfNotFound</h4>
If this option is set to true : The importer will try to detect Adm for features if the AdmXcodes values does not correspond to a known Adm. set this option to true activate errors correction. If set to false errors correction is disabled and if no Adm is found for the AdmXcode, the feature will be linked to a null Adm.<br/><br/>This option is case sensitive and must be set in lower case.
Example : There is an adm with level 2 which have adm1Code = 'A1' and adm2Code = 'B2' in the datastore, suppose there is a gisFeature which have Adm1code='A3' and Adm2Code='B2', Gisgraphy will detect an error because there is no Adm with those codes. so if this option is set to true, Gisgraphy will correct the error and will link the feature to the Adm with codes adm1Code = 'A1' and adm2Code = 'B2'. If if this option is set to false, Gisgraphy won't try to correct the error,  put a warning message in logs, and  links the Feature to a null Adm. 

<div class="code">
Examples : <br/>
importerConfig.tryToDetectAdmIfNotFound=true<br/>
importerConfig.tryToDetectAdmIfNotFound=false
</div>
<br/><br/>
<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.syncAdmCodesWithLinkedAdmOnes</h4>
This option is a little bit difficult to understand. An example is often simpler than a big speech ;). First, there is a few little thing to know : a feature has the following properties:<br/>
FeatureId......Adm...Adm1Code...Adm2Code...Adm3Code...Adm4Code...adm1Name...Adm2Name...adm3Name...Adm4Name...
<br/>
and an Adm is a feature too and has the same properties.<br/> 
So a feature is linked to an administrative division (AKA : Adm). For performance reasons, the codes and names of the Adms are stored in the Feature itself too.<br/>
Now consider the example <a href="#tryToDetectAdmIfNotFound">above</a> : if there is an error the adm will not be the same as the Codes in The CSV files. this option allow to choose beetween two strategy :
<ul>
<li>If <code>importerConfig.syncAdmCodesWithLinkedAdmOnes</code> is set to 'true' then the admXcodes and admXnames of the features will be the same as the linked Adm One (in our example : if <code>importerConfig.tryToDetectAdmIfNotFound</code>is set to 'true' the adm1Code will be 'A1' and the Adm2Code will be 'B2' that's to say the same as the Adm ones)</li>
<li>If <code>importerConfig.syncAdmCodesWithLinkedAdmOnes</code> is set to 'false', the admXcodes and admXnames of the features will be the same as the CSV file (in our example : if <code>importerConfig.tryToDetectAdmIfNotFound</code> is set to 'true', the adm1Code will be 'A3' and the Adm2Code will be 'B2' And the Linked Adm will be null) </li>
</ul>

In other words if you want the importer to set the admXcode and admXnames with the CSV one : set this option to false. if you want those codes to be the same as the linked Adm : set it to true.
<br/>
if you don't know what to do : set it to the recommended value : true. This option is case sensitive and must be set in lower case.

<br/>
<div class="tip yellowtip">
importerConfig.tryToDetectAdmIfNotFound and importerConfig.syncAdmCodesWithLinkedAdmOnes are orthogonal concepts
</div>
<br/><br/>


<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.admXExtracterStrategyIfAlreadyExists</h4>
In order to import the Adm before the other features, Gisgraphy extract the Adm1, Adm2, Adm3 and Adm4 files. This option tells what to do if an AdmX file (determines with the <code>importerConfig.admXFileName</code> option) is already present in the <code>importer.geonames.dir</code>.This option is case sensitive. 3 options are available : 
<ul>
<li>skip : the extract will be skiped, and the file already presents will be used</li>
<li>backup : the file already present will be backup (with the date and the current time), a new file will be extracted and used</li>
<li>reprocess : the file will be replace by the new one</li>
</ul>

<div class="code">
Examples : <br/>
importerConfig.adm3ExtracterStrategyIfAlreadyExists=reprocess<br/>
importerConfig.adm4ExtracterStrategyIfAlreadyExists=skip
</div>
<br/><br/>


<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.adm1FileName</h4>
Specify the filename of the CSV file with Administrative division with level 1. Should normally be 'admin1Codes.txt'. This option is case sensitive if the underlaying file system is case sensitive<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.adm2FileName</h4>
Specify the filename of the CSV file with Administrative division with level 2. Should normally be 'admin2Codes.txt'. This option is case sensitive if the underlaying file system is case sensitive<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.adm3FileName</h4>
Specify the filename of the CSV file with Administrative division with level 3. Should normally be 'admin3Codes.txt'. This file name will be used to extract Adm with level 3.This option is case sensitive if the underlaying file system is case sensitive
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.adm4FileName</h4>
Specify the filename of the CSV file with Administrative division with level 4. Should normally be 'admin4Codes.txt'. This file name will be used to extract Adm with level 4.This option is case sensitive if the underlaying file system is case sensitive
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.languageFileName</h4>
Specify the filename of the CSV file with languages. should normally be 'iso-languagecodes.txt'. This option is case sensitive if the underlaying file system is case sensitive
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.countriesFileName</h4>
Specify the filename of the CSV file with countries information. Should normally be 'countries.txt'. This option is case sensitive if the underlaying file system is case sensitive
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.alternateNamesFileName</h4>
Specify the filename of the CSV file with languages. Should normally be 'alternateNames.txt'. This option is case sensitive if the underlaying file system is case sensitive
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>importerConfig.importGisFeatureEmbededAlternateNames</h4>
Some of the alternate names are provided in each country dump file and all the alternate names with languages and additionnal information are in a separated file name. The alternate names provided in the country files are incomplete. if you want to import the alternate names of the country files (faster but a lot of informations are lost) set this option to true, in that case the importerConfig.alternateNamesFileName will be ignored. if you want a full import with the alternatenames separated file set this option to false. This option is case sensitive and must be set in lowercase.
<div class="code">
Examples : <br/>
importerConfig.importGisFeatureEmbededAlternateNames=true<br/>
importerConfig.importGisFeatureEmbededAlternateNames=false
</div>
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>fulltextsearch.maxConnectionsPerHost</h4>
Limits the numbers of connections to the SolR server per host. Recommended : 32.
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<h4>fulltextsearch.maxTotalConnections</h4>
Limits the numbers of connections to the SolR server for all hosts. Recommended : 128.
<br/><br/>

<div align="right"><a href="#top">[top]</a></div>
<a name="defaultGeolocSearchPlaceType"></a>
<h4>geolocsearch.defaultGeolocSearchPlaceType</h4>
define the default placetype Class for the geoloc query. An empty or wrong value will search for any placetype by default. This option is case sensitive. and the placeType must be in the entity package
<div class="code">
Examples : <br/>
geolocsearch.defaultGeolocSearchPlaceType=City<br/>
geolocsearch.defaultGeolocSearchPlaceType=
</div>
<div class="tip yellowtip">
This name of the class should not ends with '.class' but is case sensitive.
</div>
<br/><br/>

<a name="importfailure"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Import failure</h3>
When an error occured during import. You have to:
<ul>
<li>Find and repair the error</li>
<li>Reset the database(A script is provided in the sql directory), because some data are already in the database and you'll have duplicate key / constraints exceptions.</li>
<li>Restart the web application, in order to flush the cache and to reset the configuration : importers keep informations of what have been imported. So you must restart the web application in order to clear those informations</li>
<li>Re-run the import</li> 
</ul>
<br>
<div class="tip redtip">
Never re-run an import before cleaning the database and restart the web application, it will failed!!.
</div>
<br/>

<a name="fulltextservice"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Full text service</h2>
<a name="fulltextservicedescription"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Description</h3>
<br/>
The full text service allows to search for features / places.<br/>
you can
<ul>
	<li> Specify one or more words</li>
	<li> Search for text or zip code</li>
	<li> Limit the results to a specific
		<ul>
		<li>Language</li>
		<li>Country</li>
		<li><a href="http://www.gisgraphy.com/placetype.htm">place type</a></li>
		</ul>
	</li>
	<li> Paginate the results</li>
	<li> Specify the ouput verbosity</li>
	<li> Tells if you want the output to be indented</li> 
</ul>

The search is case insensitive, use synonyms (Saint/st, ..), separator characters stripping, ...

<a name="fulltextserviceparameters"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Parameters</h3>
<ul>
<a name="searchedtext"></a>
<li>The searched text (required) : The text for the query, it can be a zip code, a String or one or more String.
<br/> Examples : 
<ul>
<li>30980</li>
<li>Paris</li>
<li>paris france</li>
</ul>
</li>
<br/>
<a name="startindex"></a>
<li>Start pagination index (optional) : The first pagination index. Numbered from 1. If the number is < 1 or not specified, it will be set to the default value : 1.</li>
<br/>
<a name="endindex"></a>
<li>End pagination Index (optional) : The last pagination index. if < 1 or not specified, it will be set to startindex + 10.</li>
<br/>
<a name="outputformat"></a>
<li>The output format (optional) : The formats available are :<br/>
<ul>
<li>XML (Default) : <a href="./examples/fulltextsearch.xml">Example</a></li>
<li>PHP : <a href="./examples/fulltextsearch.php">Example</a></li>
<li>JSON  : <a href="./examples/fulltextsearch.json">Example</a></li>
<li>PYTHON : <a href="./examples/fulltextsearch.python">Example</a></li>
<li>RUBY : <a href="./examples/fulltextsearch.ruby">Example</a></li>
<li>ATOM : <a href="./examples/fulltextsearch_atom.xml">Example</a></li>
<li>GEORSS : <a href="./examples/fulltextsearch_georss.xml">Example</a></li>
</ul>
</li>
<br>
<a name="languagecode"></a>
<li>The language code (optional) : The <a href="http://en.wikipedia.org/wiki/List_of_languages">iso 639 Alpha2 or alpha3 Language Code</a>. 
Some properties as the AlternateName AdmNames and countryname belongs to a certain language code, The language parameter can limits the output of those fields to a certain language (it only apply for the FULL style) : 
<br/><br/>
<ul>
<li> If the language code does not exists or is not specified, properties with all the languages are retirved</li>
<li> If it exists, the properties with the specified language code, are retrieved</li>
</ul>
</li>
<br/>
<div class="tip greentip">
use the alpha2 code when possible, only use the alpha3 code when no alpha2 code exists for the language.
</div>
<br/>


<br/>
<a name="outputstyleverbosity"></a>
<li>The output style verbosity (optional) : Determines the output verbosity. 4 styles are available :<br/><br/>
<ul>
<li>Short : feature_id, name, fully_qualified_name, zipcode (if city), placetype, country_code, country_name</li>
<li>Medium (default) : Short + lat, lon, feature_class, feature_code, population, fips</li>
<li>Long  : Medium + adm1_name, adm2_name, adm3_name, Adm4_name, adm1_code, Adm2_code, Adm3_code, Adm4_code</li>
<li>Full : Long + alternateNames, country_alternate_name, adm1_alternate_name, adm2_alternate_name. If the language parameter is specified : only alternate names with the specified language are retrive, otherwise, all the alternate names for all the languages are retrieve</li>
</ul>
</li>
<br/>
<div class="tip greentip">
For a full list and descrition of output fields : see <a href="#fulltextserviceoutputfieldsdescription" >bellow</a>.
</div>
<br/>


<br/>
<a name="placetype"></a>
<li>The placetype (optional) : limit the search to the specified place type. place type regroup some feature class and feature code. you need to specify the class coresponding to the place type you want to search. default : search for all features</li>

<br/>
<div class="tip greentip">
See a full list and explanation of placetype : <a href="http://www.gisgraphy.com/placetype.htm">here</a>.
</div>
<br/>

<br/>
<a name="countrycode"></a>
<li>The country code (optional) : limit the search to the specify <a href="http://en.wikipedia.org/wiki/ISO_3166"> ISO 3166 </a> country code. Default : search in all countries</li>
<br/><br/>

<br/>
<a name="indent"></a>
<li>The indentation (optional) : indents the results. Default to false. the possible values are true|false (or "on" when used with the rest service <a href="#indentonfulltext">see</a></li>) Georss and Atom won't be indented for performance reason
<br/><br/>



</ul>
<a name="fulltextwebservice"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Web service</h3>

The full text web service use a servlet to wrap the Java API. It links web parameters to a fulltext query and output the results via HTTP.
<br/>
All the parameters should be case insensitive. if you've got some problems with case, please <a href="/issue-tracking.html">notify a bug</a>.

<div class="tip yellowtip">
 All the parameters should be encoded in <a href="http://fr.wikipedia.org/wiki/UTF-8">UTF-8</a> and the URL MUST be <a href="http://www.w3schools.com/TAGS/ref_urlencode.asp">encoded</a>.
</div>
<br/><br/>
Here is a summary of the Web parameters mapping : <br/>
<table class="smallsizetable smartborder">
<th>Parameter name</th><th>Web parameter name</th>
<tr><td>The searched text</td><td>q</td></tr>
<tr><td>Start pagination index</td><td>from</td></tr>
<tr><td>End pagination index</td><td>to</td></tr>
<tr><td>Output format</td><td>format</td></tr>
<tr><td>Language code</td><td>lang</td></tr>
<tr><td>Output style verbosity</td><td>style</td></tr>
<tr><td>placetype</td><td>placetype</td></tr>
<tr><td>country code</td><td>country</td></tr>
<tr><td>indent</td><td>indent</td></tr>
</table>
<br/>

<div class="tip greentip" name="indentonfulltext">
If you use a checkbox in a form to indent the results, the value will be "on" or "off", so for a simple use : the value of indent, for the fulltext web service can be "true" or "on".
</div>

<div class="code">
Examples : <br/>
http://localhost:8080/fulltext/fulltextsearch?q=paris&from=1&to=10&format=xml&amp;lang=fr&style=short&placetype=city&country=fr&indent=true<br/><br/>
http://localhost:8080/fulltext/fulltextsearch?q=paris<br/><br/>
</div>
<br/>

<br/>
<div class="tip yellowtip">
Actually, the webservice limits the number of results to 10.
</div>
<br/>

<div class="tip greentip">
By default the fulltext service is mapped to <code>/fulltext</code> pattern but you can change it in the WEB-INF/web.xml<br/><br/>
</div>
<br/><br/>

 

<a name="fulltextserviceoutputfieldsdescription"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Output fields description</h3>
Here is a description of all the output fields :<br/>
<table class="mediumsizetable smartborder">
<th>Field</th><th>Description</th><th>Available from style</th>
<tr><td><span color="red">error</span></td><td>A String only present if an error occured (e.g : empty query)<br/>The field 'error' appears in the path response/responseHeader/error </td><td><span color="red">ERROR</span></td></tr>
<tr><td>feature_id</td><td>A unique id that identify the feature</td><td>SHORT</td></tr>
<tr><td>Name</td><td>The name of the feature</td><td>SHORT</td></tr>
<tr><td>fully_qualified_name</td><td>A name of the form : (adm1Name et adm2Name are printed) Paris, D&eacute;partement de Ville-De-Paris, Ile-De-France, (FR)</td><td>SHORT</td></tr>
<tr><td>placetype</td><td>The <a href="placetype.htm">place Type</a> of the Feature</td><td>SHORT</td></tr>
<tr><td>country_code</td><td>The <a href="http://en.wikipedia.org/wiki/ISO_3166">ISO 3166</a> country code</td><td>SHORT</td></tr>
<tr><td>country_name</td><td>The name of the country the features belongs to</td><td>SHORT</td></tr>
<tr><td>zipcode</td><td>The zipcode (only for city plactetype)</td><td>SHORT</td></tr>
<tr><td>google_map_url</td><td>The URL to get the location on <a href="http://maps.google.com/">Google Map</a></td><td>MEDIUM</td></tr>
<tr><td>yahoo_map_url</td><td>The URL to get the location on <a href="http://maps.yahoo.com/">Yahoo Map</a></td><td>MEDIUM</td></tr>
<tr><td>country_flag_url</td><td>The relative URL to get the country flag image</td><td>MEDIUM</td></tr>
<tr><td>feature_class</td><td>The feature Class. <a href="http://download.geonames.org/export/dump/featureCodes.txt">More</a>...</td><td>MEDIUM</td></tr>
<tr><td>feature_code</td><td>The feature Code. <a href="http://download.geonames.org/export/dump/featureCodes.txt">More</a>...</td><td>MEDIUM</td></tr>
<tr><td>population</td><td>How many people lives in this feature</td><td>MEDIUM</td></tr>
<tr><td>elevation</td><td>Elevation in meters</td><td>MEDIUM</td></tr>
<tr><td>name_ascii</td><td>The ascii name</td><td>MEDIUM</td></tr>
<tr><td>timezone</td><td>The timezone (e.g :Europe/Paris)</td><td>MEDIUM</td></tr>
<tr><td>gtopo30</td><td>Average elevation of 30'x30' (ca 900mx900m) area in meters</td><td>MEDIUM</td></tr>
<tr><td>lat</td><td>The latitude (north-south)</td><td>MEDIUM</td></tr>
<tr><td>lng</td><td>The longitude (east-West)</td><td>MEDIUM</td></tr>
<tr><td>adm1_code</td><td>The internal code for the administrative division of level 1</td><td>LONG</td></tr>
<tr><td>adm2_code</td><td>The internal code for the administrative division of level 2</td><td>LONG</td></tr>
<tr><td>adm3_code</td><td>The internal code for the administrative division of level 3</td><td>LONG</td></tr>
<tr><td>adm4_code</td><td>The internal code for the administrative division of level 4</td><td>LONG</td></tr>
<tr><td>adm1_name</td><td>The name of the administrative division of level 1</td><td>LONG</td></tr>
<tr><td>adm2_name</td><td>The name of the administrative division of level 2</td><td>LONG</td></tr>
<tr><td>adm3_name</td><td>The name of the administrative division of level 3</td><td>LONG</td></tr>
<tr><td>adm4_name</td><td>The name of the administrative division of level 4</td><td>LONG</td></tr>
<tr><td>name_alternate</td><td>The alternate names of the feature that without specific language code</td><td>LONG</td></tr>
<tr><td>name_alternate_<i>languagecode</i></td><td>The alternate names of the feature for this <a href="http://en.wikipedia.org/wiki/List_of_languages">language Code</a></td><td>LONG</td></tr>
<tr><td>adm1_name_alternate</td><td>The alternate names of the administrative division of level 1 without specific language code</td><td>FULL</td></tr>
<tr><td>adm1_name_alternate_<i>languagecode</i></td><td>The alternatenames of the administrative division of level 1 for this <a href="http://en.wikipedia.org/wiki/List_of_languages">language Code</a></td><td>FULL</td></tr>
<tr><td>adm2_name_alternate</td><td>The alternate names of the administrative division of level 2 without specific language code</td><td>FULL</td></tr>
<tr><td>adm2_name_alternate_<i>languagecode</i></td><td>The alternatenames of the administrative division of level 2 for this <a href="http://en.wikipedia.org/wiki/List_of_languages">language Code</a></td><td>FULL</td></tr>
<tr><td>adm3_name_alternate</td><td>The alternate names of the administrative division of level 3 without specific language code</td><td>FULL</td></tr>
<tr><td>adm3_name_alternate_<i>languagecode</i></td><td>The alternatenames of the administrative division of level 3 for this <a href="http://en.wikipedia.org/wiki/List_of_languages">language Code</a></td><td>FULL</td></tr>
<tr><td>adm4_name_alternate</td><td>The alternate names of the administrative division of level 4 without specific language code</td><td>FULL</td></tr>
<tr><td>adm4_name_alternate_<i>languagecode</i></td><td>The alternatenames of the administrative division of level 4 for this <a href="http://en.wikipedia.org/wiki/List_of_languages">language Code</a></td><td>FULL</td></tr>
<tr><td>country_name_alternate</td><td>The alternate names of the country without specific language code</td><td>FULL</td></tr>
<tr><td>country_name_alternate_<i>languagecode</i></td><td>The alternate names of the country for this <a href="http://en.wikipedia.org/wiki/List_of_languages">language Code</a></td><td>FULL</td></tr>
</table>
<br/><br/>

<a name="fulltextservicejavaapi"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Java API</h3>

The fulltext API looks like this
<div class="code">
<pre>
			Pagination pagination = paginate().from(<a href="#startindex">STARTINDEX</a>).to(<a href="#endindex">ENDINDEX</a>);
			Output output = Output.withFormat(<a href="#outputformat">OUTPUTFORMAT</a>)
					.withLanguageCode(<a href="#languagecode">LANGUAGECODE</a>).withStyle(<a href="#outputstyleverbosity">VERBOSITY</a>)
					.<a href="#indent">WithIndentation</a>();
					
			FulltextQuery fulltextQuery = new FulltextQuery("<a href="#searchedtext">SEARCHEDTEXT</a>",
					pagination, output, <a href="#placetype">PLACETYPE</a>.class, <a href="#countrycode">COUNTRYCODE</a>);
			String result = fullTextSearchEngine.executeQueryToString(fulltextQuery);
</pre>
</div>

<div class="tip greentip">
Click on the UPPERCASE parameters above to see the description of the parameter.
</div>


Here is an example :

<div class="code">
<pre>
			Pagination pagination = paginate().from(1).to(10);
			Output output = Output.withFormat(OutputFormat.XML)
					.withLanguageCode("FR").withStyle(OutputStyle.SHORT)
					.WithIndentation();
			FulltextQuery fulltextQuery = new FulltextQuery("Paris Texas",
					pagination, output, City.class, "US");
			String result = fullTextSearchEngine.executeQueryToString(fulltextQuery);
</pre>
</div>
<br/>
You can output results to an OutputStream (useful for servlet use) or a String. 
<br/> The API is thread safe.
<br/> It is possible to create a query directly from a HTTP servlet request
<br/>
<div class="tip greentip">
The methods are  Designed with <a href="http://www.infoq.com/articles/internal-dsls-java">DSL</a> (Domain Specific Language), and can be chained as in the example above.
</div>
<br/>
<a name="geolocservice"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Geolocalisation service</h2>
<a name="geolocservicedescription"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Description</h3>
<br/>
The geolocalisation service allows to search for features around earth location.<br/>
you can
<ul>
	<li> Specify GPS position</li>
	<li> Limit the results to a specific <a href="placetype.htm">place type</a> (e.g : search all monuments around a point)</li>
	<li> Limit the results to a specified radius</li>
	<li> Paginate the results</li>
	<li> Tells if you want the output to be indented (currently, apply only for XML, not json for performance reasons. may change in next version) </li> 
</ul>

<a name="geolocserviceparameters"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Parameters</h3>
<ul>
<a name="latitudegeoloc"></a>
<li>The latitude (required) (north-south) for the location point to search around. The value is a float and can be negative. It use GPS coordinates.
<br/> Examples : 
<ul>
<li>-4.2</li>
</ul>
</li>
<br/>


<a name="longitudegeoloc"></a>
<li>The longitude (required) (east-West) for the location point to search around. The value is a float and can be negative. It use GPS coordinates.
<br/> Examples : 
<ul>
<li>3.6</li>
</ul>
</li>
<br/>
<a name="radiusgeoloc"></a>
<li>The radius (optional) : distance from the location point in meters we'd like to search around. The value is a number > 0 if it is not specify or incorrect : The default value will be used (10 km).
<br/> Examples : 
<ul>
<li>50000</li>
</ul>
</li>
<br/>
<a name="startindexgeoloc"></a>
<li>Start pagination index (optional) : The first pagination index. Numbered from 1. If the number is < 1 or not specified, it will be set to the default value : 1.</li>
<br/>
<a name="endindexgeoloc"></a>
<li>End pagination Index (optional) : The last pagination index. if < 1 or not specified, it will be set to startindex + 10.</li>
<br/>
<a name="outputformatgeoloc"></a>
<li>The output format (optional) : The formats available are :<br/>
<ul>
<li>XML (Default) : <a href="./examples/geolocsearch.xml">Example</a></li>
<li>JSON  : <a href="./examples/geolocsearch.json">Example</a></li>
<li>ATOM : <a href="./examples/geolocsearch_atom.xml">Example</a></li>
<li>GEORSS : <a href="./examples/geolocsearch_georss.xml">Example</a></li>
</ul>
</li>
<br>


<br/>
<a name="placetype"></a>
<li>The placetype (optional) : limit the search to the specified place type. place type regroup some feature class and feature code. you need to specify the class coresponding to the place type you want to search. default : search for all features</li>

<br/>
<div class="tip yellowtip">
For performance reasons, it is highly recommended to specify a placetype (if you use web GUI, put a required parameter with the placetype)
</div>
<br/>

<br/>
<div class="tip greentip">
See a full list and explanation of placetype : <a href="placetype.htm">here</a>.
</div>
<br/>

<br/>
<a name="indentgeoloc"></a>
<li>The indentation (optional) : indents the results. Default to false. the possible values are true|false (or "on" when used with the rest service <a href="#indentongeoloc">see</a></li></li>
<br/>

<div class="tip greentip" name="indentongeoloc">
If you use a checkbox in a form to indent the results, the value will be "on" or "off", so for a simple use : the value of indent, for the geoloc web service can be "true" or "on".
</div>


<div class="tip yellowtip">
 Actually, only XML can be indented. It is not a bug :  Indent JSON is possible but decrease performance. If it is a critical need you can see an example of how indent json in source code of GeolocSearchEngine.
</div>
<br/><br/>
</ul>
<a name="geolocwebservice"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Web service</h3>

The geolocalisation web service use a servlet to wrap the Java API. It links web parameters to a geoloc query and output the results via HTTP.
<br/>
All the parameters should be case insensitive. if you've got some problems with case, please <a href="/issue-tracking.html">notify a bug</a>.

<div class="tip yellowtip">
 All the parameters should be encoded in <a href="http://fr.wikipedia.org/wiki/UTF-8">UTF-8</a> and the URL MUST be <a href="http://www.w3schools.com/TAGS/ref_urlencode.asp">encoded</a>.
</div>
<br/><br/>
Here is a summary of the Web parameters mapping : <br/>
<table class="smallsizetable smartborder">
<th>Parameter name</th><th>Web parameter name</th>
<tr><td>Latitude</td><td>lat</td></tr>
<tr><td>Longitude<td>lng</td></tr>
<tr><td>Radius</td><td>radius</td></tr>
<tr><td>Start pagination index</td><td>from</td></tr>
<tr><td>End pagination index</td><td>to</td></tr>
<tr><td>Output format</td><td>format</td></tr>
<tr><td>Placetype</td><td>placetype</td></tr>
<tr><td>Indent</td><td>indent</td></tr>
</table>
<br/>
<div class="code">
Examples : <br/>
http://localhost:8080/geoloc/findnearbylocation?lat=4.5&lng=5.7&radius=5000&from=1&to=10&format=xml&placetype=city&indent=true<br/><br/>
http://localhost:8080/geoloc/findnearbylocation?lat=4.5&lng=5.7<br/><br/>
</div>
<br/>

<br/>
<div class="tip yellowtip">
Actually, the webservice limits the number of results to 10.
</div>
<br/>

<div class="tip greentip">
By default the geolocalisation service is mapped to <code>/geoloc</code> pattern but you can change it in the WEB-INF/web.xml<br/><br/>
</div>
<br/><br/>

 

<a name="geolocserviceoutputfieldsdescription"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Output fields description</h3>
Here is a description of all the output fields :<br/>
<table class="mediumsizetable smartborder">
<th>Field</th><th>Description</th>
<tr><td><span color="red">error</span></td><td>A String only present if an error occured (e.g : empty Latitude or longitude)</td><td></td></tr>
<tr><td>numFound</td><td>The number of results display with this query (it takes the pagination into account)</td></tr>
<tr><td>QTime</td><td>The execution time of the query in ms</td></tr>
<tr><td>distance</td><td>The distance beetween the point and the gisFeature in meters</td></tr>
<tr><td>Name</td><td>The name of the feature</td></tr>
<tr><td>asciiName</td><td>The ASCII name of the feature</td></tr>
<tr><td>feature_id</td><td>A unique id that identify the feature</td><td>SHORT</td></tr>
<tr><td>countryCode</td><td>The <a href="http://en.wikipedia.org/wiki/ISO_3166">ISO 3166</a> country code</td></tr>
<tr><td>google_map_url</td><td>The URL to get the location on <a href="http://maps.google.com/">Google Map</a></td></tr>
<tr><td>country_flag_url</td><td>The relative URL to get the country flag image</td></tr>
<tr><td>yahoo_map_url</td><td>The URL to get the location on <a href="http://maps.yahoo.com/">Yahoo Map</a></td></tr>
<tr><td>zipcode</td><td>The zipcode (only for city plactetype)</td></tr>
<tr><td>featureClass</td><td>The feature Class. <a href="http://download.geonames.org/export/dump/featureCodes.txt">More</a>...</td></tr>
<tr><td>featureCode</td><td>The feature Code. <a href="http://download.geonames.org/export/dump/featureCodes.txt">More</a>...</td></tr>
<tr><td>placeType</td><td>The Type of Feature see faq</td></tr>
<tr><td>population</td><td>How many people lives in this feature</td></tr>
<tr><td>lat</td><td>The latitude (north-south)</td></tr>
<tr><td>lng</td><td>The longitude (east-West)</td></tr>
<tr><td>adm1Code</td><td>The internal code for the administrative division of level 1</td></tr>
<tr><td>adm2Ccode</td><td>The internal code for the administrative division of level 2</td></tr>
<tr><td>adm3Code</td><td>The internal code for the administrative division of level 3</td></tr>
<tr><td>adm4Code</td><td>The internal code for the administrative division of level 4</td></tr>
<tr><td>adm1Name</td><td>The name of the administrative division of level 1</td></tr>
<tr><td>adm2Name</td><td>The name of the administrative division of level 2</td></tr>
<tr><td>adm3Name</td><td>The name of the administrative division of level 3</td></tr>
<tr><td>adm4Name</td><td>The name of the administrative division of level 4</td></tr>
<tr><td>timezone</td><td>The time zone (e.g : Europe/Paris)</td></tr>
<tr><td>gtopo30</td><td>Average elevation of 30'x30' (ca 900mx900m) area in meters</td></tr>
<tr><td>elevation</td><td>The elevation in meters</td></tr>
</table>
<br/><br/>

<a name="geolocservicejavaapi"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Java API</h3>

The geoloc API looks like this
<div class="code">
<pre>
			Point point = GeolocHelper.createPoint(<a href="#longitudegeoloc">LONGITUDE</a>, <a href="#latitudegeoloc">LATITUDE</a>);
			Pagination pagination = paginate().from(<a href="#startindexgeoloc">STARTINDEX</a>).to(<a href="#endindexgeoloc">ENDINDEX</a>);
			Output output = Output.withFormat(<a href="#outputformatgeoloc">OUTPUTFORMAT</a>)
								  .<a href="#indentgeoloc">WithIndentation</a>();
			GeolocQuery query = new GeolocQuery(point,<a href="#radiusgeoloc">RADIUS</a>,pagination,output,<a href="#placetype">PLACETYPE</a>.class);
			String results = geolocSearchEngine.executeQueryToString(query);
</pre>
</div>

<div class="tip greentip">
Click on the UPPERCASE parameters above to see the description of the parameter.
</div>


Here is an example :

<div class="code">
<pre>
			Point point = GeolocHelper.createPoint(-3.5F, 45F);
			Pagination pagination = paginate().from(1).to(10);
			Output output = Output.withFormat(OutputFormat.XML)
								  .WithIndentation();	
			GeolocQuery geolocQuery = new GeolocQuery(point,100000
					pagination, output, City.class);
			String result = geolocSearchEngine.executeQueryToString(geolocQuery);
</pre>
</div>
<br/>
<div class="tip greentip">
The methods are  Designed with <a href="http://www.infoq.com/articles/internal-dsls-java">DSL</a> (Domain Specific Language), and can be chained as in the example above.
</div>
<br/>

<br/>
You can output results to an OutputStream (useful for servlet use) or a String.
<br/> The API is thread safe.
<br/> It is possible to create a query directly from a HTTP servlet request
<br/>
<a name="admininterface"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Admin Interface</h2>
 to access the admin interface :
 <ul>
 <li>Launch gisgraphy</li>
 <li>Open a web browser and go to <a href="http://localhost:8080/mainMenu.html">http://localhost:8080/login.jsp</a> (according that gisgraphy is running on port 8080)</li>
 </ul>
 <br/>
<a name="adminloginpassword"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Login - Password</h3>

<div class="tip yellowtip">
You can insert the two default users with the provided script in the sql directory : insert_users.sql
</div>

There is two default users already set :
<table class="mediumsizetable smartborder">
<th>user</th><th>password</th><th>profile</th><th>Description</th>
<tr><td>user</td><td>user</td><td>ROLE_USER</td><td>user with simple rights : can not admin other users, can only edit his profile, can not import data</td></tr>
<tr><td>admin</td><td>admin</td><td>ROLE_ADMIN</td><td>user with all rights : can admin other users and profiles, can edit options,can import data.</td></tr>
</table>
<br/>
<div class="tip yellowtip">
It is highly recommended to change the default users of the admin interface. To do so : You must login as 'admin' with password 'admin' or edit the 'insert_users.sql' file in the sql directory, set the users / passwords / roles, and run the script
</div>
<br/>
<a name="adminimportdata"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Import data</h3>
To import data, you must log With a user with admin rights. Then go to the <b>Administration</b> menu -> <b>Run importer</b> and check the configuration. Click on the 'Run importer' link.
a page with the import status will be display and refresh every minuts.

<div class="tip yellowtip">
The importer process may takes more than 24 hours, depending on how much data you import and the machine the importer runs on. (some <a href="http://www.gisgraphy.com/dump.htm">dumps</a> will be soon availables)<br/>
because The admin inteface is based on Appfuse : If you have some questions about basic features of the admin interface, see <a href="http://appfuse.org/">Appfuse</a> documentation 
</div>


<a name="adminscreenshots"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Screenshots</h3>
some screenshots are available <a href="http://www.gisgraphy.com/screenshots.htm">here</a>
<br/><br/><br/>
<a name="security"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Security</h2>
<a name="defaultusersecurity"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Default admin password</h3>
<br/>
<div class="tip yellowtip">
It is highly recommended to change the default users of the admin interface. To do so : You must login as 'admin' with password 'admin'
</div>
<br/>
<a name="protectwebservices"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Protect webServices</h3>
Some users wants to restrict the solr engine to the host 'localhost' in order to disallow user to ask the SolR search engine directly. You can use a firewall and restrict the access of the Webapp with the following code
<div class="code">
With Tomcat : 
<pre>
&lt;Context path="/path/to/secret_files"&gt;
  &lt;Valve className="org.apache.catalina.valves.RemoteAddrValve"
         allow="127.0.0.1" deny=""/&gt;
&lt;/Context&gt;
</pre>
<br><br/>
With Jetty : <br/> 
<pre>
A server configuration-XML-file can look something like this:
&lt;Configure class="org.mortbay.jetty.Server"&gt;
...
&lt;Call name="addContext"&gt;
...
&lt;Call name="addHandler"&gt;
&lt;Arg&gt;
&lt;New class="IPAccessHandler"&gt;
&lt;Set name="Standard"&gt;deny&lt;/Set&gt;
&lt;Set name="AllowIP"&gt;192.168.0.103&lt;/Set&gt;
&lt;Set name="AllowIP"&gt;192.168.0.100&lt;/Set&gt;
&lt;/New&gt;
&lt;/Arg&gt;
&lt;/Call&gt;
</pre>
<br/>
</div>
<br/>
See more on <a href="http://www.jdocs.com/jetty/5.1.11.rc0/org/mortbay/http/handler/IPAccessHandler.html">http://www.jdocs.com/jetty/5.1.11.rc0/org/mortbay/http/handler/IPAccessHandler.html</a>
<br/>
<a name="performance"></a>
<div align="right"><a href="#top">[top]</a></div>
<h2>Performance</h2>
<a name="jmeter"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Jmeter</h3>
Some Jmeter benchs are available (scripts and results) <a href="/bench.htm">here</a>.
<br/>
<a name="databaseoptimisation"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>Database optimisations</h3>
in order to have good performances it is recommended to use database indexes. as far as I know it is possible to tell Hibernate to create index but not possible to choose the type of index (BTREE,GIST, and so on) with annotations. so you must create your own index with the following code :  
<div class="code">
<pre>
DROP  INDEX IF EXISTS locationindex ;

CREATE INDEX locationindex
  ON gisfeature
  USING gist
  ("location");

VACUUM FULL ANALYZE;
<pre>

</div>
<br/>
You can proceed for all the tables which have Geometry collumns.
<br/>
A script named 'createGISTIndex.sql' is provided in the 'SQL' dir in the Gisgraphy distribution to create all the GIST indexes for all the tables
<br/><br/>
You will have GREATER performnance if you specify a placetype, if you search for placetype 'gisFeature', your query will be slower.<br/><br/>
<div class="tip greentip">
You can define the default Geoloc Placetype in the env file (in the Classpath) with the option <a href="#geolocsearch.defaultGeolocSearchPlaceType">defaultGeolocSearchPlaceType</a>
</div>


<br/><br/>
<div class="tip greentip">
You can use command line but PGAdmin could be a friendly way.
</div>
<br/>

<div class="tip yellowtip">
If you use Postgis 1.3.1 or greater you don't have to use the GIST indexes because they will automatically be used. <a href="http://www.postgis.org/pipermail/postgis-users/2007-August/016628.html">More</a> .
</div>
<br/>

It is recommended to run :
<div class="code"> VACUUM FULL ANALYZE;</div>
on postgres, after an import

<a name="jvmoptimisation"></a>
<div align="right"><a href="#top">[top]</a></div>
<h3>JVM optimisations</h3>

You will have better performances if you run Gisgraphy and the SolR server in two distinct JVM.
To run solr in a separated JVM copy the solr Directory (default parameter) with the schema.xml, solrconfig.xml, the data directory, and so on to a <a href="http://lucene.apache.org/solr/">SolR</a> distribution and start it with <code>java -jar start.jar</code> (or an other way of your choice, that's the easier way).
Then you can remove the solr.war from the Gisgraphy release and configure the <a href="#fulltextsearchurl">fulltextsearch URL</a> to point to the new Solr URL.
It is also recommended to use the sun JVM (not the GCJ one) and to use the VMargs -server
<div id="logos">
<a href="http://maven.apache.org/"><img src="../logos/maven.png" alt="Maven 2" class="logo"/></a>
<a href="http://springframework.org/"><img src="../logos/spring25.png" alt="Spring Framework" class="logo"/></a>
<a href="http://www.hibernate.org/" target="_blank"><img src="../logos/hibernate.png" alt="hibernate" class="logo"/></a>
<a href="http://www.postgresql.org/"><img src="../logos/postgres.gif" alt="postgres" class="logo"></a>
<a href="http://postgis.refractions.net/"><img src="../logos/postgis.jpg" alt="postgis" class="logo"></a>
<a href="http://struts.apache.org/2.x/index.html/"><img src="../logos/struts2.png" class="logo"/></a>
<a href="http://lucene.apache.org/solr/"><img src="../logos/solr.png" alt="Solr" class="logo"></a>
<a href="http://lucene.apache.org/java/docs/index.html"><img src="../logos/lucene.gif" alt="Lucene" class="logo"></a>
<a href="https://jersey.dev.java.net/"><img src="../logos/jersey.png" alt="jersey" class="logo" /></a>
<a href="http://appfuse.org/"><img src="../logos/appfuse.gif" class="logo"/></a>
</div>
</body>
</html>